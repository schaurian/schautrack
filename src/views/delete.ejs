<%- include('partials/header', { title: 'Account Deletion', activePage }) %>
  <section class="panel stack">
    <div class="panel-header">
      <div>
        <p class="eyebrow">Schautrack</p>
        <h1>Delete your account</h1>
      </div>
    </div>

    <% if (deleteFeedback) { %>
      <div class="alert <%= deleteFeedback.type === 'error' ? 'danger' : 'success' %>"><%= deleteFeedback.message %></div>
    <% } %>

    <% if (currentUser) { %>
      <p class="muted">You are signed in as <strong><%= currentUser.email %></strong>. Re-authenticate to confirm deletion.</p>
      <form action="/delete" method="POST" class="stack data-card">
        <label class="field">
          <span>Password</span>
          <input type="password" name="password" required placeholder="Your password">
        </label>
        <% if (currentUser.totp_enabled) { %>
          <label class="field">
            <span>2FA code</span>
            <input type="text" name="token" inputmode="numeric" pattern="[0-9]*" placeholder="123456" required>
          </label>
        <% } else { %>
          <p class="muted small">If you have 2FA enabled, you will also need to enter your 6-digit code.</p>
        <% } %>
        <p class="muted danger-text small">
          This will permanently delete your account, entries, and linked account relationships. This action cannot be undone.
        </p>
        <button type="submit" class="ghost danger full">Delete my account</button>
      </form>
    <% } else { %>
      <% if (supportEmail) { %>
        <div class="data-card stack">
          <h2>Request deletion without signing in</h2>
          <ol class="stack" style="padding-left: 1.2rem;">
            <li>Send an email to <a href="mailto:<%= supportEmail %>?subject=Schautrack%20Account%20Deletion%20Request"><%= supportEmail %></a>.</li>
            <li>Use the subject line: <code>Schautrack Account Deletion Request</code>.</li>
            <li>From the email address associated with your account, include:
              <ul style="padding-left: 1.1rem; margin-top: 0.35rem;">
                <li>A statement requesting deletion of your Schautrack account and data.</li>
                <li>Any additional context that might help us locate your account (optional).</li>
              </ul>
            </li>
            <li>We will confirm the request and remove associated data as required.</li>
          </ol>
          <p class="muted">
            If you no longer have access to the email on file, mention that in your message and provide details
            that help us verify ownership. We will guide you through the next steps.
          </p>
        </div>
      <% } %>

      <div class="data-card stack">
        <h3>Prefer to delete while signed in?</h3>
        <p class="muted">Log in to verify and delete instantly.</p>
        <a class="primary" href="/login?next=/delete">Login to delete</a>
      </div>

      <% if (supportEmail) { %>
        <p class="muted small">Need help? Email <a href="mailto:<%= supportEmail %>"><%= supportEmail %></a>.</p>
      <% } %>
    <% } %>
  </section>
<%- include('partials/footer') %>
