  </main>
  <footer class="shell footer">
    <div class="footer-content">
      <div class="footer-left">
        <div class="footer-quote">You got this. Trust me.</div>
      </div>
      <div class="footer-right">
        <% if (enableLegal) { %>
          <div class="footer-links">
            <% if (imprintUrl) { %>
              <a class="muted-link" href="<%= imprintUrl %>" <%= imprintUrl.startsWith('/') ? '' : 'target="_blank" rel="noopener"' %>>Imprint</a>
              <span class="separator">—</span>
            <% } %>
            <a class="muted-link" href="/privacy">Privacy</a>
            <span class="separator">—</span>
            <a class="muted-link" href="/terms">Terms</a>
          </div>
        <% } %>
        <% if (buildVersion) { %>
          <div class="build-tag muted small" id="version-tag">
            <a href="https://gitlab.com/florianschauer/schautrack" target="_blank" rel="noopener" class="muted-link" title="View on GitLab">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                <path d="M23.955 13.587l-1.342-4.135-2.664-8.189a.455.455 0 0 0-.867 0L16.418 9.45H7.582L4.918 1.263a.455.455 0 0 0-.867 0L1.386 9.452.044 13.587a.924.924 0 0 0 .331 1.023L12 23.054l11.625-8.443a.92.92 0 0 0 .33-1.024"/>
              </svg>v<%= buildVersion %>
            </a>
          </div>
        <% } %>
      </div>
    </div>
  </footer>
  <script>
    // Detect and store timezone for accurate date/time display
    (function() {
      try {
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (tz) {
          document.cookie = 'timezone=' + encodeURIComponent(tz) + '; path=/; max-age=31536000; SameSite=Lax';
        }
      } catch (e) {
        console.error('Failed to detect timezone:', e);
      }
    })();

    // Version check for production builds (checks every hour, cached in localStorage)
    (function() {
      const versionTag = document.getElementById('version-tag');
      if (!versionTag) return;

      const currentVersion = versionTag.textContent.trim().replace(/^v/, '');
      const isSemver = /^\d+\.\d+\.\d+$/.test(currentVersion);
      if (!isSemver) return; // Only check for production semver builds

      const CACHE_KEY = 'schautrack_latest_version';
      const CACHE_DURATION = 60 * 60 * 1000; // 1 hour

      async function checkVersion() {
        try {
          const cached = localStorage.getItem(CACHE_KEY);
          if (cached) {
            const { version, timestamp } = JSON.parse(cached);
            if (Date.now() - timestamp < CACHE_DURATION) {
              return version;
            }
          }

          const res = await fetch('https://gitlab.com/api/v4/projects/schauer.to%2Fschautrack/repository/tags?per_page=1');
          if (!res.ok) return null;

          const tags = await res.json();
          const latest = tags[0]?.name?.replace(/^v/, '') || null;

          if (latest) {
            localStorage.setItem(CACHE_KEY, JSON.stringify({ version: latest, timestamp: Date.now() }));
          }
          return latest;
        } catch (e) {
          return null;
        }
      }

      function isOutdated(current, latest) {
        const currentParts = current.split('.').map(Number);
        const latestParts = latest.split('.').map(Number);
        for (let i = 0; i < 3; i++) {
          if ((currentParts[i] || 0) < (latestParts[i] || 0)) return true;
          if ((currentParts[i] || 0) > (latestParts[i] || 0)) return false;
        }
        return false;
      }

      checkVersion().then(latest => {
        if (latest && isOutdated(currentVersion, latest)) {
          versionTag.classList.add('outdated');
          versionTag.querySelector('a').title = 'Update available: v' + latest;
        }
      });
    })();
  </script>
  <style>
    .build-tag.outdated,
    .build-tag.outdated .muted-link {
      color: var(--danger, #ef4444) !important;
    }
  </style>
</body>
</html>
