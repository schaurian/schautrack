<%- include('partials/header', { title: 'Create account' }) %>
  <section class="panel">
    <div class="panel-header">
      <div>
        <p class="eyebrow">Start tracking</p>
        <h1>Create your account</h1>
      </div>
      <a href="/login" class="ghost">Already have one?</a>
    </div>
    <% if (error) { %>
      <div class="alert danger"><%= error %></div>
    <% } %>
    <% if (requireCaptcha) { %>
      <p class="muted">Verify you're human to create your account.</p>
      <form action="/register" method="POST" class="stack">
        <input type="hidden" name="step" value="captcha">
        <div class="field">
          <span>Enter the text shown below</span>
          <div class="captcha-image"><%- captchaSvg %></div>
          <input type="text" name="captcha" required autocomplete="off" placeholder="Enter captcha" autofocus>
        </div>
        <button type="submit" class="primary">Create account</button>
      </form>
    <% } else { %>
      <form action="/register" method="POST" class="stack">
        <input type="hidden" name="timezone" id="timezoneField">
        <input type="hidden" name="step" value="credentials">
        <label class="field">
          <span>Email</span>
          <input type="email" name="email" value="<%= email %>" required autocomplete="email">
        </label>
        <label class="field">
          <span>Password</span>
          <input type="password" name="password" required autocomplete="new-password">
        </label>
        <button type="submit" class="primary">Continue</button>
      </form>
    <% } %>
    <script>
      // Detect and populate timezone field for user registration
      (function() {
        try {
          const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
          const field = document.getElementById('timezoneField');
          if (tz && field) {
            field.value = tz;
          }
        } catch (e) {
          console.error('Failed to detect timezone:', e);
        }
      })();
    </script>
  </section>
<%- include('partials/footer') %>
